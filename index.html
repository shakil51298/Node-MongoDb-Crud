<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <title>Database MongoDB</title>
</head>
<body>
    <h3>Look mom, i have mongo db database!!!!</h3>
    <form  action="/addProduct" method="post">
        <input  type="text" placeholder="Pname" name="Pname">
        <input  type="text" placeholder="price" name="price">
        <input  type="text" placeholder="quantity" name="quantity">
        <input class="btn btn-primary" type="submit" value="Add Product">
    </form>
    <div id="products">

    </div>
    <div id="update">

    </div>


    <script> // READ DATA FROM DATA BASE MONGOBD
        const loadAllProducts = () => {
                const url = 'http://localhost:3000/products'
            fetch(url)
            .then(res => res.json())
            .then(data => {
                showData(data);
            })

            const showData = data => {
                const mainDiv = document.getElementById('products');
                data.map(pd => {
                    console.log(pd);
                    const pp = document.createElement('p');
                    pp.innerHTML=`name: ${pd.Pname} -- price : ${pd.price} -- quantity : ${pd.quantity}
                        <button  onclick="loadProducts('${pd._id}')" class="btn btn-primary">Update </button>
                        <button  onclick="loadAllProducts('${pd._id}')" class="btn btn-danger">Delete data </button>
                    `;
                    mainDiv.appendChild(pp)
                })
            }
        }
        const loadProducts = (id)=>{
            fetch(`/product/${id}`)
            .then( res => res.json())
            .then(data => {
                const update = document.getElementById('update')
                update.innerHTML = `
                <h3>Updating :${id}</h3>
                <input type="text" value="${data.price}"  id="price">
                <br>
                <input type="text" value="${data.quantity}"  id="quantity">
                <br>
                <button class="btn btn-danger">submit update</button>
                `
                console.log(data);
            })
        }
        loadAllProducts();
        const deletProducts = (id) =>{
            fetch(`/delete/${id}`, {
                method: "DELETE"
            })
            .then(res => res.json())
            .then(data => {
                console.log("delete succesfully");
            })
        }

    </script>
</body>
</html>